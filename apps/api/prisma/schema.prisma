// =====================================================
// Datasource & Generator
// =====================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================================================
// MODELS
// =====================================================

// -----------------------------------------------------
// Usuário do sistema
// -----------------------------------------------------
model User {
  id          Int          @id @default(autoincrement())
  name        String
  email       String       @unique
  createdAt   DateTime     @default(now())
  accounts    Account[]
  categories  Category[]
  transactions Transaction[]
  recurrings  Recurring[]
}

// -----------------------------------------------------
// Contas financeiras (carteira, Nubank crédito, Itaú débito…)
// -----------------------------------------------------
model Account {
  id          Int          @id @default(autoincrement())
  name        String
  type        AccountType
  userId      Int
  user        User         @relation(fields: [userId], references: [id])
  transactions Transaction[]
  createdAt   DateTime     @default(now())
}

// Tipos de conta
enum AccountType {
  CASH       // dinheiro vivo
  DEBIT      // débito
  CREDIT     // cartão de crédito
  SAVINGS    // conta de poupança / investimento
  OTHER
}

// -----------------------------------------------------
// Categoria de despesa/receita (Comida, Transporte…)
// -----------------------------------------------------
model Category {
  id          Int           @id @default(autoincrement())
  name        String
  type        CategoryType
  userId      Int
  user        User          @relation(fields: [userId], references: [id])
  createdAt   DateTime      @default(now())
  transactions Transaction[]
}

// Tipo da categoria
enum CategoryType {
  EXPENSE
  INCOME
}

// -----------------------------------------------------
// Transação (despesa, receita, transferência)
// -----------------------------------------------------
model Transaction {
  id              Int            @id @default(autoincrement())
  amount          Float
  description     String?
  type            TransactionType
  date            DateTime       @default(now())
  userId          Int?
  user            User?           @relation(fields: [userId], references: [id])
  accountId       Int?
  account         Account?        @relation(fields: [accountId], references: [id])
  categoryId      Int?
  category        Category?      @relation(fields: [categoryId], references: [id])
  
  // Parcelamento
  installment      Int?          // ex: 2
  installmentTotal Int?          // ex: 6
  installmentGroup String?       // identificador único para vincular parcelas
  
  // Recorrência
  recurringId     Int?
  recurring       Recurring?     @relation(fields: [recurringId], references: [id])

  createdAt       DateTime       @default(now())
}

// Tipo de transação
enum TransactionType {
  EXPENSE
  INCOME
  TRANSFER
}

// -----------------------------------------------------
// Despesas/Receitas recorrentes (assinaturas, aluguel…)
// -----------------------------------------------------
model Recurring {
  id            Int            @id @default(autoincrement())
  name          String
  amount        Float
  type          CategoryType   // receita ou despesa
  dayOfMonth    Int            // dia do vencimento (1–28)
  userId        Int
  user          User           @relation(fields: [userId], references: [id])
  createdAt     DateTime       @default(now())
  transactions  Transaction[]
}
